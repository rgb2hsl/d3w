var d3w={};d3w.regexp={};d3w.regexp.month={};d3w.regexp.month.en2ru="ЯнвJan ФевFeb МарMar АпрApr МайMay ИюнJun ИюлJul АвгAug СенSep ОктOct НояNov ДекDec";d3w.regexp.month.en2ruDo=function(e){return e.replace(/[a-zA-Z]+/,d3w.regexp.month.en2ru.match("[а-яА-Я]+(?="+e.match(/[a-zA-Z]+/)+")"))};d3w.types={line:0,stakedbars:1,groupedbars:2,roundDiagram:3};d3w.axis={};d3w.axis.time={};d3w.axis.time.quantumSingleDateScrolled=function(e,t,n){var r,i,s,o=e.meta.horisontalTicksCount,u=[],a,f=d3.min(e.meta.allDates),l=d3.max(e.meta.allDates);e.meta.axis.timeTickFormat=function(e){return d3w.regexp.month.en2ruDo(d3.time.format("%d %b").call(null,d3.time.day.offset(l,-e)))};a=e.meta.axis.timeTickFormat;r=e.meta.axis.daysCount=d3.time.days(f,l).length+1;i=e.meta.axis.datesDomain=d3.range(r);scale=d3.scale.ordinal().domain(i).rangeRoundBands([e.width,0],.3);if(!("scales"in e.meta.axis))e.meta.axis.scales={};e.meta.axis.scales[n]=scale;e.meta.axis.object=scale;s=Math.round(r/o);if(s<1)s=1;var c=[];for(var h=0;h<r;h+=s){u.push(h)}c[0]=d3.svg.axis().scale(scale).orient(e.meta.axis.axisOrient[n]).tickFormat(a).tickValues(u);c[0].position=0;for(var h=0;h<r;h++){if(h%s!=0){c[h]=d3.svg.axis().scale(scale).orient(e.meta.axis.axisOrient[n]).tickFormat(a).tickSize(25).tickValues([h]);c[h].position=h}}if(!("objects"in e.meta.axis))e.meta.axis.objects={};e.meta.axis.objects[n]=c;return c};d3w.axis.time.linearSingleDateScrolled=function(e,t,n){var r,i=[],s,o,u,a=[],f;minDate=d3.min(e.meta.allDates),maxDate=d3.max(e.meta.allDates);u=d3.time.days(minDate,maxDate).length+1;r=e.meta.axis.datesDomain=[minDate,maxDate];o=e.meta.axis.timeTickFormat=d3w.axis.util.time.timeTickFormat;s=d3.time.minutes(r[0],r[1]).length/(e.meta.horisontalTicksCount-1);if(e.meta.horisontalTicksCount<e.meta.datumsCount.max){i.push(r[0]);var l=r[0];for(var c=0;c<e.meta.horisontalTicksCount-2;c++){l=d3.time.minute.offset(l,s);i.push(l)}i.push(r[1])}else{for(var h in t){for(var p in t[h].data){i.push(t[h].data[p].x)}}}scale=d3.time.scale().range(e.meta.axis.axisRanges[n]).domain(r);if(!("scales"in e.meta.axis))e.meta.axis.scales={};e.meta.axis.scales[n]=scale;e.meta.axis.object=scale;a[0]=d3.svg.axis().scale(scale).orient(e.meta.axis.axisOrient[n]).tickFormat(o).tickValues(i);a[0].position=0;for(var c=1,d;c<u-1;c++){d=d3.time.day.offset(minDate,c);a[c]=d3.svg.axis().scale(scale).orient(e.meta.axis.axisOrient[n]).tickFormat(o).tickSize(25).tickValues([d]);a[c].position=d}if(!("objects"in e.meta.axis))e.meta.axis.objects={};e.meta.axis.objects[n]=a;return a};d3w.axis.time.linear=function(e,t,n){var r,i=[],s,o;r=e.meta.axis.datesDomain=[d3.min(e.meta.allDates),d3.max(e.meta.allDates)];o=e.meta.axis.timeTickFormat=d3w.axis.util.time.timeTickFormat;s=d3.time.minutes(r[0],r[1]).length/(e.meta.horisontalTicksCount-1);if(e.meta.horisontalTicksCount<e.meta.datumsCount.max){i.push(r[0]);var u=r[0];for(var a=0;a<e.meta.horisontalTicksCount-2;a++){u=d3.time.minute.offset(u,s);i.push(u)}i.push(r[1])}else{for(var f in t){for(var l in t[f].data){i.push(t[f].data[l].x)}}}scale=d3.time.scale().range(e.meta.axis.axisRanges[n]).domain(r);if(!("scales"in e.meta.axis))e.meta.axis.scales={};e.meta.axis.scales[n]=scale;e.meta.axis.object=scale;if(!("objects"in e.meta.axis))e.meta.axis.objects={};e.meta.axis.objects[n]=d3.svg.axis().scale(scale).orient(e.meta.axis.axisOrient[n]).tickFormat(o).tickValues(i)};d3w.axis.linear=function(e,t,n){var r=[e.meta.minAndMax[n].min,e.meta.minAndMax[n].max];if("domains"in e.options&&n in e.options.domains&&"min"in e.options.domains[n]){r[0]=e.options.domains[n].min}scale=d3.scale.linear().range(e.meta.axis.axisRanges[n]).domain(r);if(!("scales"in e.meta.axis))e.meta.axis.scales={};e.meta.axis.scales[n]=scale;e.meta.axis.object=scale;if(!("objects"in e.meta.axis))e.meta.axis.objects={};e.meta.axis.objects[n]=d3.svg.axis().scale(scale).orient(e.meta.axis.axisOrient[n]).ticks(e.meta.verticalTicksCount)};d3w.axis.util={axisExtra:function(e){if(e=="quantumSingleDateScrolled"||e=="linearSingleDateScrolled")return function(){this.margin.bottom+=20};else return false},axisTypes:function(e){if(e==d3w.types.line){return{x:{"default":d3w.axis.time.linear,linear:d3w.axis.time.linear,linearSingleDateScrolled:d3w.axis.time.linearSingleDateScrolled},y:{"default":d3w.axis.linear}}}else if(e==d3w.types.stakedbars||e==d3w.types.groupedbars){return{x:{"default":d3w.axis.time.quantumSingleDateScrolled,quantumStepped:d3w.axis.time.quantumStepped,quantumSingleDateScrolled:d3w.axis.time.quantumSingleDateScrolled},y:{"default":d3w.axis.linear}}}else if(e==d3w.types.roundDiagram){return null}},meta:{calculate:{recatangularAxises:function(e,t){if(!("axis"in e.meta))e.meta.axis={};e.meta.axis.axisRanges={x:[0,e.width],y:[e.height,0]};e.meta.axis.axisOrient={x:"bottom",y:"left"};e.meta.axis.axisTransform={x:"translate(0,"+e.height+")"};return d3w.axis.util.meta.calculate}}},time:{timeTickFormat:function(e){return d3w.regexp.month.en2ruDo(d3.time.format("%d %b").call(null,e))}},hideAllIAxises:function(){d3.select(this).selectAll(".x.axis").filter(function(e){return e.position!=0}).classed("d3w-iaxis",true).style("display","none")}};d3w.axis.draw=function(e,t){var n=d3w.axis.util.axisTypes(e.options.type),r,i;if(!n)return false;for(axis in n){typesFunctions=n[axis];if(axis in e.options.axises){if(e.options.axises[axis]in typesFunctions){r=typesFunctions[e.options.axises[axis]]}else{}}else{r=typesFunctions["default"]}if(typeof r=="function"){r(e,t,axis)}}i=e.svgCanvas.append("g").attr("class","d3w-axises");for(axisesKey in e.meta.axis.objects){var s=i.append("g");if(axisesKey in e.meta.axis.axisTransform)s.attr("transform",e.meta.axis.axisTransform[axisesKey]);var o=e.meta.axis.objects[axisesKey];if(o instanceof Array){for(var u=0;u<o.length;u++)if(u in o)s.append("g").attr("class","axis").classed(axisesKey,true).datum({position:o[u].position}).call(o[u])}else{s.attr("class","axis").classed(axisesKey,true).call(o)}}};d3w.util={};d3w.util.parseOptions=function(e){if("type"in e){if(e.type in d3w.types){e.type=d3w.types[e.type]}else{return false}}else{e.type=d3w.types.line}if(!("axises"in e)){e.axises={}}else{if(!("x"in e.axises)){e.axises}}if(!("canvas"in e))return false;if(!("height"in e)){e.height=200}else{e.height=parseInt(e.height)}if(!("margin"in e)){e.margin={top:20,right:20,bottom:30,left:50}}else{if(!("top"in e.margin)||!("right"in e.margin)||!("bottom"in e.margin)||!("left"in e.margin))e.margin={top:20,right:20,bottom:30,left:50}}if("x"in e.axises&&d3w.axis.util.axisExtra(e.axises.x))d3w.axis.util.axisExtra(e.axises.x).call(e);return e};d3w.util.parseDate=d3.time.format("%d.%m.%Y").parse;d3w.util.d3wChart={};d3w.util.d3wChart.make=function(e){var t={};t.options=e;t.canvasElement=e.canvas;t.canvasElementSelection=d3.select(t.canvasElement).classed("d3w-chart",true);t.heightCanvas=e.height;t.widthCanvas=t.canvasElement.scrollWidth;t.width=t.widthCanvas-e.margin.left-e.margin.right,t.height=t.heightCanvas-e.margin.top-e.margin.bottom;t.svgCanvas=t.canvasElementSelection.append("div").attr("class","d3w-wrapper").append("svg").attr("width",t.width+e.margin.left+e.margin.right).attr("height",t.height+e.margin.top+e.margin.bottom).append("g").attr("transform","translate("+e.margin.left+","+e.margin.top+")");t.meta={};return t};d3w.util.d3wChart.meta={};d3w.util.d3wChart.meta.calculate=function(e,t){var n=e.options.type;if(n==d3w.types.line){d3w.util.d3wChart.meta.calculate.parseAllDates(t).orderDatums(t).axisTicksCount(e).datumsCount(e,t).collectAllDates(e,t).minAndMax(e,t);d3w.axis.util.meta.calculate.recatangularAxises(e,t)}else if(n==d3w.types.stakedbars){d3w.util.d3wChart.meta.calculate.parseAllDates(t).orderDatums(t).axisTicksCount(e).simultaneousSums(e,t).collectAllDates(e,t).minAndMax(e,t);d3w.axis.util.meta.calculate.recatangularAxises(e,t)}else if(n==d3w.types.groupedbars){d3w.util.d3wChart.meta.calculate.parseAllDates(t).orderDatums(t).axisTicksCount(e).collectAllDates(e,t).minAndMax(e,t);d3w.axis.util.meta.calculate.recatangularAxises(e,t)}};d3w.util.d3wChart.meta.calculate.orderDatums=function(e){var t,n;for(t in e){n=e[t];if(n.data instanceof Array){n.data.sort(function(e,t){if(e.x<t.x)return-1;else if(t.x<e.x)return 1;else return 0})}}return d3w.util.d3wChart.meta.calculate};d3w.util.d3wChart.meta.calculate.parseAllDates=function(e){var t;for(var n in e){for(var r in e[n].data){t=e[n].data[r];t.x=d3w.util.parseDate(t.x)}}return d3w.util.d3wChart.meta.calculate};d3w.util.d3wChart.meta.calculate.collectAllDates=function(e,t){var n;e.meta.allDates=[];for(var r in t){for(var i in t[r].data){n=t[r].data[i];e.meta.allDates.push(n.x=n.x)}}e.meta.allDates=d3.scale.ordinal().domain(e.meta.allDates).domain();return d3w.util.d3wChart.meta.calculate};d3w.util.d3wChart.meta.calculate.axisTicksCount=function(e){e.meta.horisontalTickWidth=40;e.meta.horisontalTicksCount=Math.round(e.width/(e.meta.horisontalTickWidth+e.meta.horisontalTickWidth/2));e.meta.verticalTickHeight=15;e.meta.verticalTicksCount=Math.round(e.height/(e.meta.verticalTickHeight+e.meta.verticalTickHeight/2.5));return d3w.util.d3wChart.meta.calculate};d3w.util.d3wChart.meta.calculate.minAndMax=function(e,t){d3w.util.d3wChart.meta.calculate.minAndMax.dataset(e,t);e.meta.minAndMax={x:{min:d3.min(t,function(e){return e.meta.minAndMax.x.min}),max:d3.max(t,function(e){return e.meta.minAndMax.x.max})},y:{min:d3.min(t,function(e){return e.meta.minAndMax.y.min}),max:d3.max(t,function(e){return e.meta.minAndMax.y.max})}};return d3w.util.d3wChart.meta.calculate};d3w.util.d3wChart.meta.calculate.minAndMax.dataset=function(e,t){for(var n=0,r;n<t.length;n++){r=t[n];if(!("meta"in r))r.meta={};r.meta.minAndMax={y:{min:d3.min(r.data,function(e){return e.y}),max:d3.max(r.data,function(e){return e.y})},x:{min:d3.min(r.data,function(e){return e.x}),max:d3.max(r.data,function(e){return e.x})}}}return d3w.util.d3wChart.meta.calculate};d3w.util.d3wChart.meta.calculate.datasetClasses=function(e,t){for(var n=0,r;n<t.length;n++){r=t[n];if(!("meta"in r))r.meta={};r.meta.minAndMax={y:{min:d3.min(r.data,function(e){return e.y}),max:d3.max(r.data,function(e){return e.y})},x:{min:d3.min(r.data,function(e){return e.x}),max:d3.max(r.data,function(e){return e.x})}}}return d3w.util.d3wChart.meta.calculate};d3w.util.d3wChart.meta.calculate.simultaneousSums=function(e,t){e.meta.simultaneousSums=[];d3.map(t).forEach(function(e,t){d3.map(t.data).forEach(function(e,t){if(e in meta.simultaneousSums)meta.simultaneousSums[e]+=t.y;else meta.simultaneousSums[e]=t.y})});e.meta.simultaneousSumsMax=d3.max(e.meta.simultaneousSums);e.meta.simultaneousSumsMin=d3.min(e.meta.simultaneousSums);return d3w.util.d3wChart.meta.calculate};d3w.util.d3wChart.meta.calculate.datumsCount=function(e,t){e.meta.datumsCount={min:d3.min(t,function(e){return e.data.length}),max:d3.max(t,function(e){return e.data.length})};return d3w.util.d3wChart.meta.calculate};d3w.chart=function(e,t){var n,r;if(typeof e=="undefined")return false;if(!(t=d3w.util.parseOptions(t||{}))){return false}r=d3w.util.d3wChart.make(t);d3w.util.d3wChart.meta.calculate(r,e);d3w.axis.draw(r,e);d3w.chart.chartTypes(r.options.type).call(null,r,e);return r};d3w.chart.chartTypes=function(e){switch(e){case d3w.types.line:return d3w.chart.line;break;case d3w.types.stakedbars:break;case d3w.types.groupedbars:return d3w.chart.groupedbars;break;case d3w.types.roundDiagram:return d3w.chart.roundDiagram;break}};d3w.chart.line=function(e,t){var r=e.meta.axis.scales.x,i=e.meta.axis.scales.y,s,o=e.svgCanvas.append("g").attr("class","d3w-line-grid"),u=e.svgCanvas.append("g").attr("class","chart d3w-line"),a=e.svgCanvas.append("g").attr("class","d3w-chart-hovers"),f,l,h;for(dataObjIndex in t){dobj=t[dataObjIndex];l="class"in dobj.options?dobj.options.class:"";f=u.append("g").attr("class","d3w-line__dataset d3w-showHide").classed(l,true);chartGrid=o.append("g").attr("class","d3w-line__dataset-grid d3w-showHide").classed(l,true);s=d3.svg.line().x(function(e){return r(e.x)}).y(function(e){return i(e.y)}).interpolate("monotone");f.append("path").datum(dobj.data).attr("class","line").classed(l,true).attr("d",s);f.selectAll(".dot").data(dobj.data).enter().append("circle").attr("class","dot").classed(l,true).attr("r",1).attr("cx",function(e){return r(e.x)}).attr("cy",function(e){return i(e.y)}).datum(function(e){return{"class":dobj.options.class,value:e.y,date:e.x}});chartGrid.selectAll(".d3w-l-crosshair").data(dobj.data).enter().append("line").attr("class","d3w-l-crosshair").attr("x1",1).attr("x2",function(e){return r(e.x)}).attr("y1",function(e){return i(e.y)}).attr("y2",function(e){return i(e.y)}).on("mouseenter",function(){event.stopPropagation()});chartGrid.selectAll(".d3w-l-crosshair-vert").data(dobj.data).enter().append("line").attr("class","d3w-l-crosshair d3w-l-crosshair-vert").attr("x1",function(e){return r(e.x)}).attr("x2",function(e){return r(e.x)}).attr("y1",e.height-1).attr("y2",function(e){return i(e.y)}).on("mouseenter",function(){event.stopPropagation()});a.selectAll(".d3w-hover").data(dobj.data,function(e){return e.x}).enter().append("rect").attr("class","d3w-hover d3w-tooltip-observer");h=a.selectAll(".d3w-hover");h.attr("y",0).attr("x",function(e,t){var i,s;h.each(function(e,n){if(n==t-1)i=e;});h.each(function(e,n){if(n==t+1)s=e;});p=r(typeof i!="undefined"?i.x:e.x);n=r(typeof s!="undefined"?s.x:e.x);c=r(e.x);d3.select(this).attr("width",Math.abs(n-(n-c)/2-(p+(c-p)/2)));return p+(c-p)/2}).attr("height",e.height).style("opacity","0").each(function(e){if(!("observers"in this))this.observers=[];this.observers.push({dots:f.selectAll(".dot").filter(function(t){return t.date==e.x}),hiddens:chartGrid.selectAll(".d3w-l-crosshair").filter(function(t){return t.x==e.x})})}).on("mouseenter",function(e){var t;for(var n=0;n<this.observers.length;n++){this.observers[n].dots.transition().duration(300).ease("elastic").attr("r",4);this.observers[n].hiddens.style("display","block");if(t=this.tooltip){this.observers[n].dots.each(function(e){t.updateSet.filter(function(t){return t==e.class}).text(e.value)})}}}).on("mouseleave",function(e){for(var t=0;t<this.observers.length;t++){this.observers[t].dots.transition().duration(50).ease("elastic").attr("r",1);this.observers[t].hiddens.style("display","none")}})}var d=e.tooltip=d3w.tooltip.add(e,t);a.selectAll(".d3w-hover").each(function(){this.tooltip=d});e.legend=d3w.legend.add(e,t);e.hideShowToggle=function(e){var t;this.canvasElementSelection.selectAll(".d3w-showHide."+e).each(function(e){if(d3.select(this).style("display")!="none"){d3.select(this).style("display","none");t=-1}else{d3.select(this).style("display","block");t=1}});return t};d3w.legend.extendAddShowHideToggles(e.legend,t);if(e.options.axises.x=="linearSingleDateScrolled"){d3w.axis.util.hideAllIAxises.call(e.svgCanvas.node());e.svgCanvas.on("mouseleave.axis",d3w.axis.util.hideAllIAxises);h.on("mouseenter.iaxis",function(t){e.svgCanvas.selectAll(".x.axis").style("display","none").filter(function(e){return e.position==0||d3.time.days(e.position,t.x)==0&&d3.time.days(t.x,e.position)==0}).style("display","block")})}};d3w.chart.roundDiagram=function(e,t){var n="labels"in e.options&&e.options.labels||!("labels"in e.options),r=e.meta.radius=Math.min(e.height-e.options.margin.top-e.options.margin.bottom,e.width-e.options.margin.left-e.options.margin.right)*(n?.3:.5),i=n?e.meta.labelPadding=10:e.meta.labelPadding=0,s=r+i,o=e.meta.donut=d3.layout.pie(),u=e.arc=d3.svg.arc().innerRadius(r*.3).outerRadius(r),a=e.svgCanvas.append("g").attr("class","d3w-round-grid"),f=e.svgCanvas.append("g").attr("class","chart d3w-round"),l=e.svgCanvas.append("g").attr("class","d3w-chart-hovers"),c=d3.scale.category10(),h,p,d;f.datum(t);a.datum(t);h=f.selectAll(".d3w-round__arc").data(e.meta.donut.value(function(e){return e.data})).enter().append("g").attr("class","d3w-round__arc").attr("transform","translate("+(r+i)+","+r+")");h.append("path").attr("class",function(e){return e.data.options.class}).classed("arc",true).attr("fill",function(e,t){return c(t)}).attr("d",u);if(n){labels=a.selectAll(".d3w-round-grid__label").data(e.meta.donut.value(function(e){return e.data})).enter().append("g").attr("class","d3w-round-grid__label").attr("transform","translate("+(r+i)+","+r+")");labels.append("svg:text").attr("transform",function(e){var t=u.centroid(e),n=t[0],r=t[1],i=Math.sqrt(n*n+r*r);return"translate("+n/i*s+","+r/i*s+")"}).attr("dy",".35em").attr("text-anchor",function(e){return(e.endAngle+e.startAngle)/2>Math.PI?"end":"start"}).text(function(e,t){return e.data.options.caption})}};d3w.chart.groupedbars=function(e,t){var n=e.meta.axis.scales.x,r=e.meta.axis.scales.y,i,s=e.svgCanvas.append("g").attr("class","d3w-groupedbars-grid"),o=e.svgCanvas.append("g").attr("class","chart d3w-groupedbars"),u=e.svgCanvas.append("g").attr("class","d3w-chart-hovers"),a,f,l,c,h,p,d;c=n.rangeBand()/t.length;e.meta.stakedbars={barWidth:c};for(dataObjIndex in t){dobj=t[dataObjIndex];f="class"in dobj.options?dobj.options.class:"";h=c*dataObjIndex;p=function(t){return n(d3.time.days(t.x,d3.max(e.meta.allDates)).length)+h};d=function(e){return r(e.y)-1};a=o.append("g").attr("class","d3w-groupedbars__dataset d3w-showHide").classed(f,true);chartGrid=s.append("g").attr("class","d3w-groupedbars__dataset-grid d3w-showHide").classed(f,true);a.selectAll(".rect").data(dobj.data.reverse()).enter().append("rect").attr("x",p).attr("y",d).attr("height",function(t){return e.height-r(t.y)}).attr("width",c).attr("class","rect").classed(f,true).each(function(e){e.class=f;d3.select(this).datum(e)});chartGrid.selectAll(".d3w-l-crosshair").data(dobj.data.reverse()).enter().append("line").attr("class","d3w-l-crosshair").attr("x1",1).attr("x2",p).attr("y1",d).attr("y2",d).on("mouseenter",function(){event.stopPropagation()});u.selectAll(".d3w-hover").data(dobj.data.reverse(),function(e){return e.x}).enter().append("rect").attr("class","d3w-hover d3w-tooltip-observer");l=u.selectAll(".d3w-hover");l.attr("x",function(t){return n(d3.time.days(t.x,d3.max(e.meta.allDates)).length)}).attr("y",0).attr("height",e.height).attr("width",n.rangeBand()*(10/8)).style("opacity","0").each(function(e){if(!("observers"in this))this.observers=[];this.observers.push({hiddens:chartGrid.selectAll(".d3w-l-crosshair").filter(function(t){return t.x==e.x}),rects:a.selectAll(".rect").filter(function(t){return t.x==e.x})})}).on("mouseenter",function(t){var n;for(var r=0;r<this.observers.length;r++){this.observers[r].hiddens.style("display","block");if(n=this.tooltip){this.observers[r].rects.each(function(e){n.updateSet.filter(function(t){return t==e.class}).text(e.y)})}}e.svgCanvas.selectAll(".x.axis").style("display","none").filter(function(n){return n.position==d3.time.days(t.x,d3.max(e.meta.allDates)).length||n.position==0}).style("display","block")}).on("mouseleave",function(e){for(var t=0;t<this.observers.length;t++){this.observers[t].hiddens.style("display","none")}})}var v=e.tooltip=d3w.tooltip.add(e,t);u.selectAll(".d3w-hover").each(function(){this.tooltip=v});e.legend=d3w.legend.add(e,t);e.hideShowToggle=function(e){var t;this.canvasElementSelection.selectAll(".d3w-showHide."+e).each(function(e){if(d3.select(this).style("display")!="none"){d3.select(this).style("display","none");t=-1}else{d3.select(this).style("display","block");t=1}});return t};d3w.legend.extendAddShowHideToggles(e.legend,t);d3w.axis.util.hideAllIAxises.call(e.svgCanvas.node());e.svgCanvas.on("mouseleave.axis",d3w.axis.util.hideAllIAxises)};d3w.legend={add:function(e,t){var n={};n.element=e.canvasElementSelection.insert("div",":first-child").attr("class","d3w-legend");if("legend"in e.options){if("caption"in e.options.legend){n.element.append("div").attr("class","d3w-legend__caption").text(e.options.legend.caption)}}n.element.selectAll(".d3w-legend__datasubset").data(t,function(e){return e.options.class}).enter().append("div").attr("class","d3w-legend__datasubset");n.element.selectAll(".d3w-legend__datasubset").append("span").attr("class","d3w-legend__datasubset-caption").text(function(e){return e.options.caption});n.element.selectAll(".d3w-legend__datasubset").append("span").attr("class","d3w-legend__datasubset-mark").datum(function(e){return e.options.class}).append("svg").append("circle").attr("class",function(e){return e+" circle"}).attr("r","5").attr("cx","5").attr("cy","5");n.element.selectAll(".d3w-legend__datasubset").sort(function(e,t){if(e.options.class<t.options.class)return-1;else if(e.options.class>=t.options.class)return 1}).order();n.d3wChart=e;return n},extendAddShowHideToggles:function(e,t){if(!("hideShowToggle"in e.d3wChart))return false;e.element.selectAll(".d3w-legend__datasubset").data(t,function(e){return e.options.class}).on("click",function(t){if(e.d3wChart.hideShowToggle.call(e.d3wChart,t.options.class)==-1)d3.select(this).classed("d3w-js-muted",true);else d3.select(this).classed("d3w-js-muted",false)})}};d3w.tooltip={add:function(e,t){var n={},r=e.canvasElementSelection.select(".d3w-wrapper").append("div").attr("class","d3w-tooltip"),i=r.node(),s;e.canvasElementSelection.select(".d3w-tooltip").selectAll(".d3w-tooltip__datasubset").data(t,function(e){return e.options.class}).enter().append("div").sort(function(e,t){if(e.options.class<t.options.class)return-1;else if(e.options.class>=t.options.class)return 1}).order().attr("class",function(e){return"d3w-tooltip__datasubset d3w-showHide "+e.options.class});e.canvasElementSelection.selectAll(".d3w-tooltip__datasubset").append("span").attr("class","d3w-tooltip__datasubset-caption").text(function(e){return e.options.caption});e.canvasElementSelection.selectAll(".d3w-tooltip__datasubset").append("span").attr("class","d3w-tooltip__datasubset-value").datum(function(e){return e.options.class});r.style("visibility","hidden").style("display","block");s=i.scrollHeight-(e.height/2-10);if(s<0)s=0;height=i.scrollHeight;v=e.options.margin.top;n.scaleTop=d3.scale.linear().range([10+v,10+v,e.height/2-s+v]).domain([10,10,e.height/2]);n.scaleBot=d3.scale.linear().range([e.height/2+s-height+v,e.height-10-height+v,e.height-10-height+v]).domain([e.height/2,e.height-10,e.height]);r.style("visibility","visible").style("display","");e.svgCanvas.on("mouseenter",function(){e.canvasElementSelection.selectAll(".d3w-tooltip__datasubset-value").classed("d3w-tooltip__datasubset-value_is_active",true);e.canvasElementSelection.selectAll(".d3w-tooltip").style("display","block")}).on("mouseleave",function(){e.canvasElementSelection.selectAll(".d3w-tooltip__datasubset-value").classed("d3w-tooltip__datasubset-value_is_active",false);e.canvasElementSelection.selectAll(".d3w-tooltip").style("display","none")}).on("mousemove.tooltipLeft",function(t){var n=d3.event.offsetX-e.options.margin.left,i=e.options.margin.top,s=e.options.margin.left;tooltipWidth=parseInt(e.canvasElementSelection.select(".d3w-tooltip").node().scrollWidth);r.style("left",(n>e.width/2?n-tooltipWidth-20+s:n+20+s)+"px")}).on("mousemove",function(t){var i=d3.event.offsetY-e.options.margin.top;tooltipHeight=parseInt(e.canvasElementSelection.select(".d3w-tooltip").style("height"));r.style("top",(i<e.height/2?n.scaleTop(i):n.scaleBot(i))+"px")});n.updateSet=r.selectAll(".d3w-tooltip__datasubset-value");return n}}